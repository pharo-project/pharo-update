'From Squeak3.9 of 7 November 2006 [latest update: #7067] on 28 March 2007 at 12:06:23 pm'!"Change Set:		weakfix2Date:			18 March 2007Author:			Martin v. Loewismake scanFor: use helper methods, remove it from subclasses"!!WeakKeyDictionary methodsFor: 'private' stamp: 'mvl 3/17/2007 18:11'!scanFor: anObject	"ar 10/21/2000: The method has been copied to this location to indicate that whenever #scanFor: changes #scanForNil: must be changed in the receiver as well."	"Scan the key array for the first slot containing either a nil (indicating an empty slot) or an element that matches anObject. Answer the index of that slot or zero if no slot is found. This method will be overridden in various subclasses that have different interpretations for matching elements."	| element start finish |	finish _ array size.	start _ self startIndexFor: anObject.		"Search from (hash mod size) to the end."	start to: finish do:		[:index | ((element _ array at: index) == nil or: [self compare: element key to: anObject])			ifTrue: [^ index ]].	"Search from 1 to where we started."	1 to: start-1 do:		[:index | ((element _ array at: index) == nil or: [self compare: element key to: anObject])			ifTrue: [^ index ]].	^ 0  "No match AND no empty slot"! !!WeakKeyDictionary methodsFor: 'private' stamp: 'mvl 3/16/2007 21:26'!scanForNil: anObject	"Private. Scan the key array for the first slot containing nil (indicating an empty slot). Answer the index of that slot."	| start finish |	start _ self startIndexFor: anObject.	finish _ array size.	"Search from (hash mod size) to the end."	start to: finish do:		[:index | (array at: index) == nil ifTrue: [^ index ]].	"Search from 1 to where we started."	1 to: start-1 do:		[:index | (array at: index) == nil ifTrue: [^ index ]].	^ 0  "No match AND no empty slot"! !WeakIdentityKeyDictionary removeSelector: #scanFor:!WeakIdentityKeyDictionary removeSelector: #scanForNil:!